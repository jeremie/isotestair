<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="444" height="560" xmlns:merapi="merapi.*" >
<mx:Script>
	<![CDATA[
		import dataoncloud.view.events.DocEvent;
	
    import com.probertson.utils.GZIPEncoder;
	import mx.rpc.events.ResultEvent;
	import merapi.messages.Message;
	import flash.filesystem.File;
	import mx.controls.Alert;  
	import mx.collections.ArrayList;
	private var ds : String;
	private var providerSql:ArrayList=new ArrayList(); 
	
	public var connection : Object;
	
	public static const EXECUTE_QUERY:String='ExecuteQuery';
	public static const CANCEL_QUERY:String='CancelQuery'; 
	public static const VIEW_CONNECTION_MANAGER:String="viewConnectionManager";
	
	private function result(event : ResultEvent): void{
		if ((event.result as Message).type=='sqlResultStart'){
                    providerSql.removeAll();
                    sqlresult.dataProvider=null;
         
         } 
         else if ((event.result as Message).type=='sqlResultStop'){
                    Alert.show('stop');
                    sqlresult.dataProvider=providerSql;
                }
                else if((event.result as Message).type=='sqlInfo'){
                    responseSQL.text+= bridge.lastMessage.data.toString() + 
                                         '\n';
                }
	}
	
	
	           private function cancelQuery():void{
                bridge.sendMessage( new Message( 'sqlRequest_cancel', "stop" ) );
            }
			private function sendEvent(type:String,body:Object):void
			{
				dispatchEvent(new DocEvent(type,body));
			}
             
            private function execute():void{
                bridge.sendMessage( new Message( 'sqlRequest_request', ds + "##" + requette.text ) );
            }
            private function onBack():void
			{
                sendEvent(VIEW_CONNECTION_MANAGER,null);
            }
            public function clearText():void
            {
            	requette.text='';
            	//sqlresult.dataProvider.
            	responseSQL.text='';
            	
            	
            }
	]]>
</mx:Script>
    <merapi:BridgeInstance id="bridge" result="result(event)" />
    <mx:TabNavigator x="10" y="10" width="422" height="527">
        <mx:Canvas label="Base de donnÃ©es" width="100%" height="100%" id="canvas3">
   
                <mx:TextArea width="397" height="157" x="10" y="36" id="requette"/>
           
                <mx:Button label="Executer" x="10" y="210" click="sendEvent(EXECUTE_QUERY,null)" id="button2"/>
            
                <mx:DataGrid width="397" height="151" x="10" y="303" id="sqlresult">
                    
                </mx:DataGrid>
           
                <mx:TextArea x="101" y="211" width="309" height="81" id="responseSQL"/>
            
                <mx:Button x="12" y="270" label="Cancel" click="dispatchEvent(new Event(CANCEL_QUERY,true));"/>
            
                <mx:Button x="10" y="462" label="Retour" click="onBack()"/>
            
                <mx:Label text="SQL :" x="10" y="10"/>
            
    
    
    
 
    
        </mx:Canvas>
    </mx:TabNavigator>
</mx:Canvas>

